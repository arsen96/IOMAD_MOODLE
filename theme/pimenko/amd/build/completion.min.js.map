{"version":3,"file":"completion.min.js","sources":["../src/completion.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @copyright  Pimenko 2019\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'theme_boost/bootstrap/tooltip'], function($, str) {\n    let completioncheck = $('#completioncheck');\n    let modulename = completioncheck.attr(\"data-modulename\");\n    let tooltipAjxY = str.get_string('completion-tooltip-manual-y', 'theme_pimenko', modulename);\n    let tooltipAjxN = str.get_string('completion-tooltip-manual-n', 'theme_pimenko', modulename);\n\n    let checkbox = document.getElementsByTagName(\"input\");\n\n    let handle_success = function(res, o) {\n        if (o !== 'success') {\n            // TODO: localize\n            alert('An error occurred when attempting to save your tick mark.\\n\\n(' + o.responseText + '.)');\n        }\n    };\n    let handle_failure = function(res, o) {\n        alert('Failed: An error occurred when attempting to save your tick mark.\\n\\n(' + o.responseText + '.)');\n    };\n\n    let toggle = function(e) {\n        e.preventDefault();\n        let form = e.target;\n        $.post({\n            url: M.cfg.wwwroot + '/course/togglecompletion.php',\n            data: 'id=' + form.getAttribute(\"data-id\") +\n                '&completionstate=' + form.getAttribute(\"data-completionstate\") +\n                '&fromajax=1&sesskey=' + M.cfg.sesskey\n        }).done(handle_success).fail(handle_failure);\n    };\n\n    return {\n        init: function() {\n            for (let i = 0; i < checkbox.length; i++) {\n                if (checkbox[i].type === \"checkbox\" && checkbox[i].className.includes(\"completioncheck\")) {\n                    let className = \"checkbox-parent\";\n                    if (checkbox[i].checked) {\n                        className += ' active';\n                    }\n                    if (checkbox[i].disabled) {\n                        className += ' disable';\n                    }\n                    checkbox[i].parentNode.className = className;\n\n                    checkbox[i].onchange = function(event) {\n                        toggle(event);\n                        let className = \"checkbox-parent\";\n                        if (event.target.getAttribute(\"data-completionstate\") === \"1\") {\n                            className += ' active';\n                            event.target.setAttribute(\"data-completionstate\", 0);\n                            $.when(tooltipAjxY).done(function(tooltipTexty) {\n                                $(event.target.parentNode).tooltip('hide')\n                                    .attr('data-original-title', tooltipTexty)\n                                    .tooltip('show');\n                            });\n                        } else {\n                            event.target.setAttribute(\"data-completionstate\", 1);\n                            $.when(tooltipAjxN).done(function(tooltipTextn) {\n                                $(event.target.parentNode).tooltip('hide')\n                                    .attr('data-original-title', tooltipTextn)\n                                    .tooltip('show');\n                            });\n\n                        }\n                        if (event.target.disabled) {\n                            className += ' disable';\n                        }\n                        event.target.parentNode.className = className;\n                    };\n                }\n            }\n\n            let help = Y.one('#completionprogressid');\n            if (help && !(Y.one('form.togglecompletion') || Y.one('.autocompletion'))) {\n                help.setStyle('display', 'none');\n            }\n        }\n    };\n});\n"],"names":["define","$","str","modulename","attr","tooltipAjxY","get_string","tooltipAjxN","checkbox","document","getElementsByTagName","handle_success","res","o","alert","responseText","handle_failure","toggle","e","preventDefault","form","target","post","url","M","cfg","wwwroot","data","getAttribute","sesskey","done","fail","init","i","length","type","className","includes","checked","disabled","parentNode","onchange","event","setAttribute","when","tooltipTexty","tooltip","tooltipTextn","help","Y","one","setStyle"],"mappings":";;;;AAoBAA,kCAAO,CAAC,SAAU,WAAY,kCAAkC,SAASC,EAAGC,SAEpEC,WADkBF,EAAE,oBACSG,KAAK,mBAClCC,YAAcH,IAAII,WAAW,8BAA+B,gBAAiBH,YAC7EI,YAAcL,IAAII,WAAW,8BAA+B,gBAAiBH,YAE7EK,SAAWC,SAASC,qBAAqB,SAEzCC,eAAiB,SAASC,IAAKC,GACrB,YAANA,GAEAC,MAAM,iEAAmED,EAAEE,aAAe,OAG9FC,eAAiB,SAASJ,IAAKC,GAC/BC,MAAM,yEAA2ED,EAAEE,aAAe,OAGlGE,OAAS,SAASC,GAClBA,EAAEC,qBACEC,KAAOF,EAAEG,OACbpB,EAAEqB,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,+BACrBC,KAAM,MAAQP,KAAKQ,aAAa,WAC5B,oBAAsBR,KAAKQ,aAAa,wBACxC,uBAAyBJ,EAAEC,IAAII,UACpCC,KAAKnB,gBAAgBoB,KAAKf,uBAG1B,CACHgB,KAAM,eACG,IAAIC,EAAI,EAAGA,EAAIzB,SAAS0B,OAAQD,OACR,aAArBzB,SAASyB,GAAGE,MAAuB3B,SAASyB,GAAGG,UAAUC,SAAS,mBAAoB,KAClFD,UAAY,kBACZ5B,SAASyB,GAAGK,UACZF,WAAa,WAEb5B,SAASyB,GAAGM,WACZH,WAAa,YAEjB5B,SAASyB,GAAGO,WAAWJ,UAAYA,UAEnC5B,SAASyB,GAAGQ,SAAW,SAASC,OAC5BzB,OAAOyB,WACHN,UAAY,kBAC0C,MAAtDM,MAAMrB,OAAOO,aAAa,yBAC1BQ,WAAa,UACbM,MAAMrB,OAAOsB,aAAa,uBAAwB,GAClD1C,EAAE2C,KAAKvC,aAAayB,MAAK,SAASe,cAC9B5C,EAAEyC,MAAMrB,OAAOmB,YAAYM,QAAQ,QAC9B1C,KAAK,sBAAuByC,cAC5BC,QAAQ,aAGjBJ,MAAMrB,OAAOsB,aAAa,uBAAwB,GAClD1C,EAAE2C,KAAKrC,aAAauB,MAAK,SAASiB,cAC9B9C,EAAEyC,MAAMrB,OAAOmB,YAAYM,QAAQ,QAC9B1C,KAAK,sBAAuB2C,cAC5BD,QAAQ,YAIjBJ,MAAMrB,OAAOkB,WACbH,WAAa,YAEjBM,MAAMrB,OAAOmB,WAAWJ,UAAYA,eAK5CY,KAAOC,EAAEC,IAAI,0BACbF,MAAUC,EAAEC,IAAI,0BAA4BD,EAAEC,IAAI,oBAClDF,KAAKG,SAAS,UAAW"}