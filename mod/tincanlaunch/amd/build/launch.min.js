define("mod_tincanlaunch/launch",["exports","jquery","core/str"],(function(_exports,_jquery,Str){var obj;
/**
   * Handles display of the launch attempt table (registrations).
   *
   * @package
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @author    David Pesce  <david.pesce@exputo.com>
   * @module    mod_tincanlaunch/launch
   */function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj},Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str);let id="",cid="",simplifiedlaunch=!1,SELECTORS_ATTEMPT_TABLE="#tincanlaunch_attempttable",SELECTORS_COMPLETION_CHECK="#tincanlaunch_completioncheck",SELECTORS_EXIT="#tincanlaunch_exit",SELECTORS_NEW_ATTEMPT="#tincanlaunch_newattempt",SELECTORS_SIMPLIFIED="#tincanlaunch_simplified",SELECTORS_SIMPLIFIED_LINK="[id^=tincanlaunch_simplifiedlink-]",SELECTORS_NEW_ATTEMPT_LINK="[id^=tincanlaunch_newattemptlink-]",SELECTORS_REATTEMPT="[id^=tincanrelaunch_attempt-]",SELECTORS_STATUSDIV="#tincanlaunch_status",SELECTORS_STATUSPARA="#tincanlaunch_status_para";_exports.init=courseid=>{let urlparams=new URLSearchParams(window.location.search);if(id=urlparams.get("id"),cid=courseid,(0,_jquery.default)(SELECTORS_SIMPLIFIED).length){simplifiedlaunch=!0;let simplifiedid=(0,_jquery.default)(SELECTORS_SIMPLIFIED_LINK).attr("id").substring(28);launchExperience(simplifiedid)}else{(0,_jquery.default)(SELECTORS_REATTEMPT).each((function(){let registrationid=(0,_jquery.default)(this).attr("id").substring(23);(0,_jquery.default)(this).on("keyup",(function(e){keyTest(e.key,registrationid)})),(0,_jquery.default)(this).on("click",(function(){launchExperience(registrationid)})),(0,_jquery.default)(this).attr("tabindex","0"),(0,_jquery.default)(this).attr("class","btn btn-primary")}));let newregistrationid=(0,_jquery.default)(SELECTORS_NEW_ATTEMPT_LINK).attr("id").substring(28);(0,_jquery.default)(SELECTORS_NEW_ATTEMPT_LINK).attr("tabindex","0"),(0,_jquery.default)(SELECTORS_NEW_ATTEMPT_LINK).on("click",(function(){launchExperience(newregistrationid)})),(0,_jquery.default)(SELECTORS_NEW_ATTEMPT_LINK).on("keyup",(function(e){keyTest(e.key,newregistrationid)}))}setInterval((function(){(0,_jquery.default)(SELECTORS_COMPLETION_CHECK).load("completion_check.php?id="+id)}),3e4)};const keyTest=(keycode,registrationid)=>{"Enter"!==keycode&&" "!==keycode||launchExperience(registrationid)},launchExperience=registrationid=>{let statuspara=(0,_jquery.default)("<p></p>").attr("id","tincanlaunch_status_para"),completionspan=(0,_jquery.default)("<span>").attr("id","tincanlaunch_completioncheck");(0,_jquery.default)(SELECTORS_STATUSDIV).append(statuspara,completionspan);const spawnedWindow=window.open("launch.php?launchform_registration="+registrationid+"&id="+id),checkWindow=setInterval((()=>{spawnedWindow.closed&&(window.console.log("xAPI content window was closed."),clearInterval(checkWindow),(0,_jquery.default)(SELECTORS_COMPLETION_CHECK).load("completion_check.php?id="+id),window.location.href=simplifiedlaunch?"/course/view.php?id="+cid:"view.php?id="+id)}),1e3);(0,_jquery.default)(SELECTORS_NEW_ATTEMPT).remove(),(0,_jquery.default)(SELECTORS_ATTEMPT_TABLE).remove(),Str.get_strings([{key:"tincanlaunch_progress",component:"tincanlaunch"},{key:"returntocourse",component:"tincanlaunch"},{key:"returntoregistrations",component:"tincanlaunch"}]).done((function(s){(0,_jquery.default)(SELECTORS_STATUSPARA).text(s[0]);let exitpara=(0,_jquery.default)("<p></p>").attr("id",SELECTORS_EXIT);simplifiedlaunch?exitpara.html("<a href='/course/view.php?id="+cid+"'>"+s[1]+"</a>"):exitpara.html("<a href='/course/view.php?id="+cid+"'>"+s[2]+"</a>"),(0,_jquery.default)(SELECTORS_STATUSPARA).after(exitpara)}))}}));

//# sourceMappingURL=launch.min.js.map